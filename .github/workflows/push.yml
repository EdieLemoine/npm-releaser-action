name: 'Push to main âœ¨'

on:
  push:
    branches:
      - main
      - alpha
      - beta

  workflow_dispatch:

jobs:
  run:
    runs-on: ubuntu-22.04
    steps:
      - run: |
          json=$(curl -s https://api.wordpress.org/core/version-check/1.7/ | jq '.offers[].version' | jq -sc 'unique | @json')
          
          echo $json

          echo "${{ fromJson(json) }}"

#  test-yarn:
#    name: 'Run yarn tests ðŸ§ª'
#    uses: ./.github/workflows/--run-tests-yarn.yml
#    secrets: inherit

  #  release:
  #    name: 'Release new version ðŸš€'
  #    uses: myparcelnl/actions/.github/workflows/--semantic-release.yml@v3
  #    secrets: inherit
  #    needs: test-yarn

#  tag:
#    name: 'Update tags'
#    needs: release
#    runs-on: ubuntu-22.04
#    steps:
#      - uses: myparcelnl/actions/update-tags@v3

#  rebase:
#    name: 'Rebase develop onto main ðŸ”€'
#    runs-on: ubuntu-22.04
#    if: ${{ always() }}
#    needs: [ test-yarn, release ]
#    steps:
#      - uses: ./rebase
#        with:
#          token: ${{ secrets.GH_REPO_TOKEN }}

#  deploy:
#    name: 'Deploy'
#    needs: release
#    runs-on: ubuntu-22.04
#    steps:
#      - uses: actions/checkout@v3
#
#      - name: 'Build'
#        run: yarn build
#
#      - name: Deploy to GitHub Pages
#        uses: JamesIves/github-pages-deploy-action@4.1.5
#        with:
#          branch: gh-pages
#          folder: dist
#          token: ${{ secrets.GH_REPO_TOKEN }}
#
#      - name: 'Summary'
#        run: |
#          echo "## Deploy summary" >> $GITHUB_STEP_SUMMARY
#          echo "" >> $GITHUB_STEP_SUMMARY
#          echo "- ðŸŸ¢ Site uploaded to GitHub Pages" >> $GITHUB_STEP_SUMMARY

  rebase-prs:
    if: always()
    runs-on: ubuntu-22.04
    steps:
      - uses: myparcelnl/actions/setup-git-credentials@v3
        id: credentials
        with:
          app-id: ${{ secrets.BOOPS_BOOPS_APP_ID }}
          private-key: ${{ secrets.BOOPS_BOOPS_PRIVATE_KEY }}

      - uses: peter-evans/rebase@v2
        with:
          token: ${{ steps.credentials.outputs.token }}
          base: ${{ github.ref_name }}
          exclude-drafts: true
