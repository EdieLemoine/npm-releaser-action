name: 'âœ¨ Push to main'

on:
  push:
    branches:
      - main

  workflow_dispatch:

jobs:
  test:
    name: 'ðŸ§ª Run tests'
    uses: edielemoine/npm-releaser-action/.github/workflows/--run-tests-yarn.yml@main
    secrets: inherit
    with:
      ref: ${{ github.event.inputs.ref || github.event.client_payload.pull_request.head.label || '' }}
      release: ${{ github.event_name == 'push' && github.ref == 'refs/heads/main' }}

  release:
    name: 'ðŸš€ Release new version'
    uses: edielemoine/npm-releaser-action/.github/workflows/--release.yml@main
    needs: test

  rebase:
    name: 'ðŸ”€ Rebase develop onto main'
    uses: edielemoine/npm-releaser-action/.github/workflows/--rebase.yml@main
    if: ${{ always() }}
    needs: [ test, release ]
    secrets: inherit
    with:
      base: main
      target: develop
